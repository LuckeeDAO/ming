# 钱包 NFT 铸造功能需求说明书（背景与决策记录）

> 基线版本：v1.0（参照 `docs/00-现行口径基线.md`）

## 文档信息

- 文档版本：v2.0
- 创建日期：2025-01-31
- 最后更新：2026-02-24
- 文档定位：背景与决策记录（非技术权威）
- 技术权威文档：`docs/钱包接口/钱包接口技术规范.md`
- 配套验收文档：`docs/钱包接口/钱包联调验收清单.md`

## 1. 背景

Ming 平台在 NFT 铸造链路中采用“前端编排 + 钱包执行”的职责分工：

- Ming 前端负责：用户交互、元数据准备、共识哈希生成、发起钱包请求
- 钱包负责：签名、上链写入、定时任务托管与执行、结果回传

该分工目标是降低耦合，保证钱包侧通用性，并将私钥相关动作稳定收敛在钱包端。

## 2. 已确认架构决策

### 2.1 接口策略（已冻结）

采用“最小化接口”策略：

- 钱包不承载 Ming 业务语义判断
- 钱包按统一协议处理 `MING_WALLET_*` 请求
- 钱包返回统一响应结构 `payload.success/data/error`

### 2.2 文档治理策略（已冻结）

为避免历史文档漂移造成实现偏差，钱包相关文档采用“一个权威规范 + 一个验收清单”模式：

- 权威规范：`钱包接口技术规范.md`
- 执行清单：`钱包联调验收清单.md`
- 本文档仅保留背景、约束来源与决策原因

## 3. 关键约束来源

### 3.1 合约权限模型（现行约束）

当前现行口径为：

- `mintConnection` 公开可调用（owner 与非 owner 均可发起铸造）
- 治理类函数（如 `updateConsensusHash`）由治理权限控制

这意味着钱包联调应验证“多类用户可铸造”而非“仅 owner 可铸造”。

### 3.2 协议约束

- 通信机制：`window.postMessage`
- 命名规则：`MING_WALLET_<ACTION>_REQUEST/RESPONSE`
- 关联字段：`messageId`
- 超时约束：Ming 侧请求超时 300s

上述协议细节以 `钱包接口技术规范.md` 为准。

## 4. 实施边界

- 本文档不再维护字段级接口细节、示例代码与错误码表
- 所有可执行技术描述统一维护在 `钱包接口技术规范.md`
- 若本文档与技术规范存在冲突，以技术规范为准

## 5. 变更记录

- v2.0（2026-02-24）：
  - 文档降级为“背景与决策记录”
  - 移除冗长实现细节与历史并行方案叙述
  - 明确单一技术权威文档与验收清单路径
