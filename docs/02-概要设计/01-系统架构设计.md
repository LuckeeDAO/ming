# 系统架构设计

## 1. 架构概述

### 1.1 系统定位

Ming（命/明）平台是一个基于四柱八字能量循环理论的Web3仪式平台，通过NFT作为能量场见证，帮助用户通过外物连接来改命。

### 1.2 核心架构原则

- **极简主义**：功能极简、操作极简、视觉极简
- **仪式感优先**：强调仪式过程的体验价值
- **文化现代融合**：传统文化与现代技术结合
- **去中心化见证**：使用区块链共识作为能量场见证

## 2. 整体架构

### 2.1 系统分层架构

```
┌─────────────────────────────────────────┐
│         用户界面层 (Presentation)        │
│  React + TypeScript + Material-UI        │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│         业务逻辑层 (Business Logic)       │
│  状态管理 + 业务服务 + 工具函数           │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│         数据访问层 (Data Access)         │
│  区块链交互 + API服务 + 本地存储          │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│         基础设施层 (Infrastructure)      │
│  区块链网络 + 存储服务 + 认证服务         │
└─────────────────────────────────────────┘
```

### 2.2 技术架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        前端应用层                            │
├─────────────────────────────────────────────────────────────┤
│  React 18 + TypeScript + Vite                                │
│  ├── 页面路由 (React Router)                                 │
│  ├── 状态管理 (Redux Toolkit + Zustand)                     │
│  ├── UI组件 (Material-UI)                                    │
│  ├── 动画效果 (Framer Motion)                                │
│  └── 国际化 (i18n)                                           │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                      区块链交互层                            │
├─────────────────────────────────────────────────────────────┤
│  Web3 集成                                                    │
│  ├── 钱包连接 (MetaMask, WalletConnect)                      │
│  ├── 智能合约交互 (ethers.js / web3.js)                      │
│  ├── NFT铸造 (ERC-721)                                       │
│  └── 交易管理                                                │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                      后端服务层                              │
├─────────────────────────────────────────────────────────────┤
│  API服务 (可选)                                              │
│  ├── 用户数据管理                                            │
│  ├── 四柱八字分析服务                                        │
│  ├── 能量循环计算                                            │
│  └── NFT元数据管理                                           │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                      数据存储层                              │
├─────────────────────────────────────────────────────────────┤
│  ├── 区块链存储 (NFT元数据、连接记录)                        │
│  ├── IPFS存储 (图片、仪式记录)                               │
│  └── 本地存储 (用户感受记录、临时数据)                       │
└─────────────────────────────────────────────────────────────┘
```

## 3. 核心模块设计

### 3.1 前端模块

#### 3.1.1 页面模块
- **首页** (`/`): 仪式连接总览
- **核心概念** (`/concept`): 能量循环理论介绍
- **连接指导** (`/connection-guide`): 外物连接选择指导
- **NFT仪式** (`/nft-ceremony`): NFT铸造流程
- **我的连接** (`/my-connections`): 个人连接记录
- **仪式资源** (`/ceremony-resources`): 仪式指南和素材
- **关于** (`/about`): 平台介绍

#### 3.1.2 功能模块
- **四柱八字分析模块**: 分析用户能量系统
- **能量循环检测模块**: 检测能量流通情况
- **外物推荐模块**: 推荐合适的连接外物
- **NFT铸造模块**: 完成仪式NFT铸造
- **记录管理模块**: 管理连接记录和感受

### 3.2 智能合约模块

#### 3.2.1 NFT合约 (ERC-721)
- **连接NFT**: 记录外物连接仪式
- **元数据管理**: 存储仪式信息
- **所有权管理**: NFT转移和查询

#### 3.2.2 能量场见证合约
- **共识记录**: 记录连接共识
- **见证验证**: 验证连接有效性
- **能量场状态**: 维护能量场状态

### 3.3 数据存储模块

#### 3.3.1 链上存储
- NFT元数据（基础信息）
- 连接时间戳
- 能量场见证记录

#### 3.3.2 IPFS存储
- 仪式图片
- 详细感受记录
- 仪式过程视频（可选）

#### 3.3.3 本地存储
- 用户临时数据
- 未发布的感受记录
- 缓存数据

## 4. 系统交互流程

### 4.1 用户完整流程

```
用户进入平台
    ↓
了解核心概念（能量循环理论）
    ↓
输入四柱八字信息
    ↓
系统分析能量循环情况
    ↓
检测能量流通缺失
    ↓
推荐合适的外物连接
    ↓
选择外物并准备仪式
    ↓
完成连接仪式
    ↓
铸造NFT作为见证
    ↓
记录仪式感受
    ↓
查看个人连接档案
```

### 4.2 数据流转

```
用户输入 → 前端处理 → 能量分析服务 → 推荐算法
    ↓
用户选择 → 仪式准备 → NFT内容创建 → IPFS上传
    ↓
元数据生成 → 智能合约调用 → 区块链记录 → NFT铸造完成
    ↓
链上验证 → 本地记录 → 个人档案更新
```

## 5. 安全设计

### 5.1 数据安全
- 用户敏感信息本地加密存储
- 四柱八字信息不上链（仅分析结果上链）
- 钱包私钥不接触前端代码

### 5.2 合约安全
- 标准ERC-721实现
- 权限控制
- 防重入攻击
- Gas优化

### 5.3 前端安全
- XSS防护
- CSRF防护
- 输入验证
- 安全提示

## 6. 性能设计

### 6.1 前端性能
- 代码分割和懒加载
- 图片优化和CDN
- 缓存策略
- 响应式优化

### 6.2 区块链交互
- 交易批处理
- Gas费优化
- 异步处理
- 错误重试机制

## 7. 扩展性设计

### 7.1 功能扩展
- 模块化设计，易于添加新功能
- 插件化架构
- 配置驱动

### 7.2 技术扩展
- 支持多链部署
- 支持多种钱包
- 支持多种NFT标准

## 8. 部署架构

### 8.1 前端部署
- 静态资源CDN
- 多环境配置
- 自动化部署

### 8.2 合约部署
- 多网络部署
- 版本管理
- 升级机制

### 8.3 服务部署
- 容器化部署
- 负载均衡
- 监控告警
