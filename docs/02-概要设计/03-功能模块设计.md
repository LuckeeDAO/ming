# 功能模块设计

## 1. 模块概述

Ming平台基于"缺失认知，外物连接，NFT见证，仪式完成"的核心理念，设计以下核心功能模块。

## 2. 核心功能模块

### 2.1 用户认证与钱包连接模块

#### 2.1.1 功能描述
- 用户通过Web3钱包连接平台
- 支持多种钱包（MetaMask、WalletConnect等）
- 钱包地址作为用户身份标识

#### 2.1.2 功能点
- 钱包连接/断开
- 钱包切换
- 网络切换（主网/测试网）
- 连接状态管理
- 安全提示

#### 2.1.3 技术实现
- ethers.js钱包集成
- 连接状态持久化
- 错误处理和重试

### 2.2 四柱八字分析模块

#### 2.2.1 功能描述
- 用户输入四柱八字信息
- 系统分析能量系统构成
- 检测能量循环流通情况
- 识别能量缺失类型

#### 2.2.2 功能点
- 四柱八字输入表单
- 能量系统分析算法
- 五行能量计算
- 能量循环检测
- 缺失元素识别
- 分析结果展示

#### 2.2.3 技术实现
- 前端计算或API服务
- 传统命理算法实现
- 结果可视化展示

#### 2.2.4 数据模型
```typescript
interface FourPillars {
  year: string;      // 年柱
  month: string;     // 月柱
  day: string;       // 日柱
  hour: string;      // 时柱
}

interface EnergyAnalysis {
  fiveElements: {
    wood: number;    // 木
    fire: number;    // 火
    earth: number;   // 土
    metal: number;   // 金
    water: number;   // 水
  };
  circulation: {
    status: 'smooth' | 'blocked' | 'weak';
    details: string;
  };
  missing: string[]; // 缺失的能量类型
}
```

### 2.3 外物连接指导模块

#### 2.3.1 功能描述
- 根据能量分析结果推荐外物
- 提供外物选择指导
- 展示外物与能量的对应关系
- 帮助用户选择合适的外物

#### 2.3.2 功能点
- 外物推荐算法
- 外物卡片展示
- 选择决策工具
- 感受问答题
- 个性化建议
- 外物详情介绍

#### 2.3.3 外物分类
```typescript
interface ExternalObject {
  id: string;
  name: string;
  element: 'wood' | 'fire' | 'earth' | 'metal' | 'water';
  category: 'nature' | 'mineral' | 'plant' | 'water' | 'fire';
  description: string;
  image: string;
  connectionMethods: ConnectionMethod[];
}

interface ConnectionMethod {
  type: 'symbolic' | 'experiential' | 'deep';
  steps: string[];
  materials: string[];
  duration: string;
}
```

#### 2.3.4 推荐算法
- 基于能量缺失类型
- 基于用户感受
- 基于外物特性匹配

### 2.4 NFT仪式铸造模块

#### 2.4.1 功能描述
- 完成外物连接仪式后铸造NFT
- NFT作为能量场见证凭证
- 记录连接信息和仪式过程

#### 2.4.2 功能点
- NFT内容创建
- 图片上传（IPFS）
- 元数据生成
- 智能合约调用
- 铸造状态跟踪
- NFT展示

#### 2.4.3 铸造流程
```
1. 选择外物
   ↓
2. 准备仪式素材
   - 上传图片
   - 填写连接信息
   ↓
3. 生成NFT元数据
   ↓
4. 上传到IPFS
   ↓
5. 调用智能合约
   ↓
6. 确认交易
   ↓
7. 铸造完成
```

#### 2.4.4 NFT元数据
```typescript
interface NFTMetadata {
  name: string;
  description: string;
  image: string; // IPFS URL
  attributes: {
    externalObject: string;
    element: string;
    connectionDate: string;
    connectionType: string;
    ceremonyNotes?: string;
  };
  ceremony: {
    before: string;  // 仪式前感受
    during: string;  // 仪式中感受
    after: string;   // 仪式后感受
  };
}
```

### 2.5 个人连接档案模块

#### 2.5.1 功能描述
- 管理用户的连接记录
- 展示持有的NFT
- 记录仪式感受
- 查看连接历史

#### 2.5.2 功能点
- 连接记录列表
- NFT展示画廊
- 感受记录管理
- 统计信息
- 时间线展示
- 分享功能

#### 2.5.3 数据模型
```typescript
interface ConnectionRecord {
  id: string;
  nftTokenId: string;
  externalObject: ExternalObject;
  connectionDate: Date;
  connectionType: string;
  feelings: {
    before: string;
    during: string;
    after: string;
  };
  nftMetadata: NFTMetadata;
  blockchainTx: string;
}
```

### 2.6 仪式资源支持模块

#### 2.6.1 功能描述
- 提供仪式指南
- 提供象征素材库
- 提供文化背景知识
- 提供仪式模板

#### 2.6.2 功能点
- 仪式指南库
- 素材库（图片、文案、音乐）
- 文化知识库
- 模板选择
- 资源下载

#### 2.6.3 资源分类
- 基础仪式指南
- 自然物特定仪式
- 季节仪式指南
- 象征图片库
- 仪式文案模板
- 音乐推荐

### 2.7 核心概念介绍模块

#### 2.7.1 功能描述
- 介绍能量循环概念
- 介绍缺失元素概念
- 介绍外物连接概念
- 平台理念说明

#### 2.7.2 功能点
- 概念介绍页面
- 理论说明
- 自我感受指引
- 常见问题
- 免责声明

## 3. 辅助功能模块

### 3.1 多语言支持模块

#### 3.1.1 功能描述
- 支持中文和英文
- 国际化界面
- 语言切换

#### 3.1.2 技术实现
- react-i18next
- 翻译文件管理
- 动态语言切换

### 3.2 响应式设计模块

#### 3.2.1 功能描述
- 适配桌面端
- 适配移动端
- 适配平板端

#### 3.2.2 技术实现
- Material-UI响应式组件
- 媒体查询
- 移动端优化

### 3.3 错误处理模块

#### 3.3.1 功能描述
- 统一错误处理
- 用户友好提示
- 错误日志记录

#### 3.3.2 功能点
- 网络错误处理
- 合约调用错误
- 用户输入验证
- 错误边界

### 3.4 加载状态模块

#### 3.4.1 功能描述
- 加载状态展示
- 进度提示
- 骨架屏

#### 3.4.2 技术实现
- Loading组件
- Skeleton组件
- 进度条

## 4. 功能优先级

### 4.1 MVP版本（第一阶段）
**核心功能**:
1. ✅ 钱包连接
2. ✅ 四柱八字输入和分析
3. ✅ 外物推荐
4. ✅ NFT铸造
5. ✅ 个人档案查看

**辅助功能**:
- 基础UI/UX
- 错误处理
- 加载状态

### 4.2 完善版本（第二阶段）
**新增功能**:
1. ✅ 仪式指南库
2. ✅ 素材库
3. ✅ 感受记录详细功能
4. ✅ 分享功能
5. ✅ 多语言支持

### 4.3 生态版本（第三阶段）
**新增功能**:
1. ✅ 社群功能
2. ✅ 用户生成内容
3. ✅ 文化活动
4. ✅ 高级分析功能

## 5. 功能流程图

### 5.1 新用户流程
```
进入平台
  ↓
连接钱包
  ↓
了解概念（可选）
  ↓
输入四柱八字
  ↓
查看分析结果
  ↓
选择外物
  ↓
准备仪式
  ↓
铸造NFT
  ↓
记录感受
  ↓
查看档案
```

### 5.2 老用户流程
```
进入平台
  ↓
连接钱包
  ↓
查看个人档案
  ↓
选择新连接（可选）
  ↓
或查看历史记录
```

## 6. 功能交互设计

### 6.1 页面跳转关系
```
首页 (/)
  ├── 核心概念 (/concept)
  ├── 连接指导 (/connection-guide)
  │     └── NFT仪式 (/nft-ceremony)
  ├── 我的连接 (/my-connections)
  │     └── 连接详情
  ├── 仪式资源 (/ceremony-resources)
  └── 关于 (/about)
```

### 6.2 状态管理
- **全局状态**: 用户钱包、连接状态
- **页面状态**: 表单数据、选择状态
- **服务状态**: API请求、合约调用

## 7. 功能扩展点

### 7.1 可扩展功能
- 多链支持
- 更多钱包支持
- 高级分析功能
- 社群功能
- 移动端App

### 7.2 集成点
- 第三方分析服务
- 社交媒体集成
- 支付集成（如需要）
- 通知服务
